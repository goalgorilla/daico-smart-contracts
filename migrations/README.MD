# DAICO Smart Contracts 
This repository holds the deployment scripts and experimental code for the 
DAICO Smart Contracts needed for the OST Crowdsale.

Clone the repository with `git clone git@github.com:peterpolman/daico-smart-contracts.git daico`

## Index

* [Compiling contracts](#compilation-of-contracts)
* [Deploying contracts](#deployment-of-contracts)

## Compiling the contracts
To deploy a contract on the blockchain we need two data sources. The compiled Binary file `.bin` containing readable code for the 
Ethereum Virtual Machine (EVM) and an Application Binary Interface `.abi` to be able to interact with the binary through the console with human readable code.

The easiest way is to use truffle for compiling the ABI and BIN code necessary for a deploy on a network of choice. This will create a build folder containing JSON files holding the ABI and binary specifications for your contracts.
```
truffle compile --network ganache
truffle compile --network geth
```

You can also deploy on a network manually with use of the web3 library,
the abi and bin of the contract generated by using the solidity compiler (solc).

```
# This shows you the abi and the bin for the specified contract and all dependent contracts.
solc --abi ./contracts/AbyssToken.sol
solc --bin ./contracts/AbyssToken.sol
 
# Write output to .abi and .bin files in the solc_build folder.
mkdir ./solc_build
solc --abi ./contracts/AbyssToken.sol -o ./solc_build/
solc --bin ./contracts/AbyssToken.sol -o ./solc_build/
``` 

Create `./deploy_token_example.js` and add these lines:

```
const ABYSSbin = require('./solc_build/ABYSS.bin');
const ABYSSabi = require('./solc_build/ABYSS.abi');

module.exports = function(callback) {
  const AbyssContract = web3.eth.contract(ABYSSabi);
  const listener = web3.eth.accounts[0]; // Contract @param 1
  const owners = [web3.eth.accounts[0]]; // Contract @param 2
  const manager = web3.eth.accounts[0]; // Contract @param 3

  AbyssContract.new(
    listener,
    owners,
    manager,
    {
      from: web3.eth.accounts[0],
      data: ABYSSbin,
    }, function (e, contract) {
      console.log(e);
      if (typeof contract.address != 'undefined') {
        console.log('Abyss is successfully deployed!.\nContract Address: ' + contract.address + '\nTransaction Hash: ' + contract.transactionHash);
      }
    }
  );

}
```

Now execute the deployment script on a network of choice (e.g. geth)!

`truffle exec deploy_token_example.js --network geth`  

## Deploying contracts
Remove contract json builds (skip this if you have the latest build) and and deploy on the chosen network.

```
# On the dev network
rm -rf build;
truffle migrate --network ganache;
```

```
# On the test network
rm -rf build;
truffle migrate --network geth;
```

**Contract deployment gas costs on Ganache**

```
ABYSS: 0x89a39167c6c94c731838301cdde61e6d4a655382
Gas usage: 2001150
ReservationFund: 0xb31ba2d2fc075b5d23b94cf73b04e756f7262395
Gas usage: 726291
PollManagedFund: 0xf2c2238392ec084ebae2d80fe997e03947954f02
Gas usage: 5719052
TheAbyssDAICO: 0xb0777f8d02d555002e511100dbfe65b66d8edbd9
Gas usage: 3654606
```